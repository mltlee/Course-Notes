\section{Prime Factorization}\label{sec:3}

\subsection{Ring Theory}\label{subsec:3.1}
Let $K$ be a number field and let $R = {\cal O}_K$ be its ring of integers. 
Recall that in Section~\ref{subsec:1.4}, we uncovered some purely 
ring theoretic facts about $R$. We'll restate them here as they'll be 
very useful to us soon. Note that when we speak about rings in this 
course, they are always commutative and unital.
\begin{enumerate}[(1)]
    \item Corollary~\ref{cor:1.19}: If $I$ is a nonzero ideal of $R$, then 
    $R/I$ is finite. 
    \item Corollary~\ref{cor:1.20}: Every nonzero prime ideal of $R$ is maximal.
    \item Corollary~\ref{cor:1.21}: $R$ is Noetherian. 
\end{enumerate}

We now give a few characterizations of being a Noetherian ring.

\begin{prop}{prop:3.1}
    Let $R$ be a ring. The following are equivalent:
    \begin{enumerate}[(1)]
        \item $R$ is Noetherian. 
        \item If $I_1 \subseteq I_2 \subseteq \cdots$ is an ascending 
        chain of ideals of $R$, then there exists some $N \in \N$ such that 
        $I_k = I_N$ for all $k \geq N$; that is, the chain terminates.
        \item Every nonempty set of ideals of $R$ has a maximal element 
        (with respect to $\subseteq$). 
    \end{enumerate}
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:3.1}]
    $(1) \Rightarrow (2)$: Let $I_1 \subseteq I_2 \subseteq \cdots$ be 
    an ascending chain of ideals in $R$. Let $I = \bigcup_{j\in\N} I_j$, 
    and note that $I$ is an ideal of $R$. Since $R$ is Noetherian, 
    we see that $I$ is finitely generated, say by $a_1, \dots, a_s$. 
    Then for each $i = 1, \dots, s$, there exists some $N_i \in \N$ such that 
    $a_i \in I_{N_i}$. Taking $N = \max\{N_1, \dots, N_s\}$, we have 
    $a_i \in I_N$ for all $i = 1, \dots, s$ and thus $I \subseteq I_N$. 
    But $I_N \subseteq I$ by definition, so equality follows. In particular, 
    we have $I_k = I_N$ for all $k \geq N$. 
    
    $(2) \Rightarrow (3)$: Suppose ${\cal I}$ is a nonempty set of ideals of 
    $R$, and let $I_1 \in {\cal I}$ (which exists because ${\cal I}$ is 
    nonempty). If $I_1$ is maximal, we're done. Otherwise, ${\cal I} \setminus 
    \{I_1\}$ must be nonempty; we can find $I_2$ from this collection 
    such that $I_1 \subseteq I_2$ (else $I_1$ was maximal). If 
    $I_2$ is not maximal, pick $I_3 \in {\cal I} \setminus \{I_1, I_2\}$ 
    such that $I_1 \subseteq I_2 \subseteq I_3$. But by assumption, this 
    process terminates; for some $N \in \N$, we have $I_k = I_N$ 
    for all $k \geq N$, and $I_N$ is our desired maximal element in ${\cal I}$.

    $(3) \Rightarrow (1)$: Let $I$ be an ideal of $R$. Let ${\cal I}$ 
    denote the collection of all finitely generated ideals of $R$ 
    contained in $I$, which is nonempty because $\langle 0 \rangle 
    \in {\cal I}$. By assumption, ${\cal I}$ has a maximal element $J$. 
    If $J \neq I$, then we can find some $a \in I \setminus J$. Then 
    $\langle J, a \rangle$ is also finitely generated and contained in 
    ${\cal I}$, contradicting maximality. It follows that $J = I$ 
    and so $I$ is finitely generated. \qed 
\end{pf}\vspace{-0.25cm}

Note that the rings that we work with in this course are not generally UFDs, 
so we do not have the classical prime factorization from first year number 
theory. However, the following proposition gives us the idea to 
consider the factorization of proper ideals into prime ideals. 
The reason why we are only considering proper ideals here is because 
taking $I = R$ fails condition (1); every prime ideal of $R$ is proper by 
definition.

\begin{prop}{prop:3.2}
    Let $R$ be Noetherian and let $I \neq R$ be an ideal. 
    There exist prime ideals $P_1, \dots, P_n$ of $R$ such that 
    \begin{enumerate}[(1)]
        \item $I \subseteq P_i$ for all $i = 1, \dots, n$; and 
        \item $P_1P_2 \cdots P_n \subseteq I$. 
    \end{enumerate}
\end{prop}

Note that the prime ideals $P_i$ above are not necessarily distinct. 
To prove this proposition, we will use an extremely common tactic in 
commutative algebra: we assume that the set of objects that does 
not satisfy the property is nonempty, take a maximal element, and derive 
a contradiction. 

\begin{pf}[Proposition~\ref{prop:3.2}]
    Let $X$ be the set of proper ideals of $R$ not having this property. 
    By contradiction, assume that $X \neq \varnothing$. Let $I \in X$ be 
    a maximal element (with respect to $\subseteq$). Then $I$ itself 
    is not prime (otherwise we can simply take $P_1 = I$), so we can find 
    $a, b \in R$ such that $ab \in I$ but $a, b \notin I$. By 
    the maximality of $I$, we have $I + \langle a \rangle, I + \langle b 
    \rangle \notin X$. 

    Note that $(I + \langle a \rangle)(I + \langle b \rangle) 
    \subseteq I$ since $I^2$, $\langle a \rangle I$, $\langle b \rangle I$, 
    and $\langle ab \rangle$ are all subsets of $I$. In particular, we have 
    $I + \langle a \rangle \neq R$ and $I + \langle b \rangle \neq R$ since 
    multiplying by $R$ does not change an ideal. 

    Therefore, we can find prime ideals $P_1, \dots, P_n, Q_1, \dots, Q_m$ 
    of $R$ such that 
    \begin{enumerate}[(1)]
        \item $I + \langle a \rangle \subseteq P_i$ for all $i = 1, \dots, n$ 
        and $I + \langle b \rangle \subseteq Q_j$ for all $j = 1, \dots, m$;
        \item $P_1 P_2 \cdots P_n \subseteq I + \langle a \rangle$ 
        and $Q_1 Q_2 \cdots Q_m \subseteq I + \langle b \rangle$. 
    \end{enumerate}
    But then we have $I \subseteq I + \langle a \rangle \subseteq P_i$ 
    and $I \subseteq I + \langle b \rangle \subseteq Q_j$. Moreover, 
    we see that 
    \[ P_1 \cdots P_n Q_1 \cdots Q_m \subseteq (I + \langle a \rangle) 
    (I + \langle b \rangle) \subseteq I. \] 
    Here, we find that $I \notin X$, which is a contradiction. \qed 
\end{pf}\vspace{-0.25cm}

We now introduce some familiar ring theory from PMATH 347, namely the 
notion of coprime ideals and the (generalized) Chinese remainder theorem. 

\begin{defn}{defn:3.3}
    Let $R$ be a ring, and let $I$ and $J$ be proper ideals of $R$. We say 
    that $I$ and $J$ are {\bf coprime} if $I + J = R$.
\end{defn}\vspace{-0.25cm}

The term coprime is used interchangeably with comaximal, but being a 
number theory course, it feels more appropriate to say coprime.
The following proposition tells us that powers of coprime ideals are also 
coprime. 

\begin{prop}{prop:3.4}
    Let $R$ be a ring. Let $I$ and $J$ be proper ideals such that $I + J = R$. 
    Then for all $n, m \in \N$, we have $I^n + J^m = R$. 
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:3.4}]
    Suppose that $I^n + J^m \neq R$. Then we have $I^n + J^m \subseteq M$ 
    for some maximal ideal $M$. This gives us $I^n \subseteq M$ and 
    $J^m \subseteq M$ as well. But maximal ideals are prime. 
    In particular, if $a \in I$, then $a^n \in M$, but since $M$ is 
    prime, we also have $a \in M$. Thus, we have $I \subseteq M$, 
    and by an identical argument, we obtain $J \subseteq M$. (This result 
    also follows from another characterization of prime ideals.)
    It follows that $I + J \subseteq M$, which is a contradiction since 
    maximal ideals are proper by definition. \qed 
\end{pf}\vspace{-0.25cm}

This leads us to the following famous theorem that we all know and love. 

\begin{theo}[Chinese Remainder Theorem]{theo:3.5}
    Let $R$ be a ring and let $I$ and $J$ be coprime ideals of $R$. Then 
    \[ R/IJ \cong R/I \times R/J. \]
\end{theo}\vspace{-0.25cm}
\newpage
\begin{pf}[Theorem~\ref{theo:3.5}]
    Define the map $\varphi : R \to R/I \times R/J$ by $\varphi(x) 
    = (x+I, x+J)$. Then we have $\ker\varphi = I \cap J$. But $IJ 
    \subseteq I+J$ always holds and since $I$ and $J$ are coprime, we obtain 
    \begin{align*}
        I \cap J &= (I \cap J)R \\ 
        &= (I \cap J)(I + J) \\ 
        &= (I \cap J)I + (I \cap J)J \subseteq IJ
    \end{align*}
    since $I \cap J \subseteq I$, $I \cap J \subseteq J$, and $R$ is 
    commutative. Thus, we have $\ker\varphi = I \cap J = IJ$. To see that 
    $\varphi$ is surjective, let $a \in I$ and $b \in J$ such that $a + b = 1$
    (which exist because $I$ and $J$ are coprime). Then for $x, y \in R$, we have 
    \begin{align*}
        \varphi(ax + by) &= (ax + by + I, ax + by + J) \\ 
        &= (by + I, ax + J) \\ 
        &= (b + I, a + J)(y + I, x + J) \\ 
        &= (1 + I, 1 + J)(y + I, x + J) \\ 
        &= (y + I, x + J),
    \end{align*}
    where the second last equality follows from looking at $b$ modulo $I$ 
    and $a$ modulo $J$. So $\varphi$ is surjective, and it follows from 
    the first isomorphism theorem that $R/IJ \cong R/I \times R/J$. \qed
\end{pf}\vspace{-0.25cm}

The generalized Chinese remainder theorem then follows from a straightforward 
induction.

\begin{theo}[Generalized Chinese Remainder Theorem]{theo:3.6}
    Let $R$ be a ring, and let $I_1, \dots, I_n$ be pairwise coprime ideals 
    (i.e. $I_i + I_j = R$ when $i \neq j$). Then 
    \[ R/I_1 \cdots I_n \cong R/I_1 \times \cdots \times R/I_n. \] 
\end{theo}\vspace{-0.25cm}

We end this section on ring theory with a property of finite rings. 

\begin{prop}{prop:3.7}
    Let $R$ be a finite ring. There exist distinct prime ideals $P_1, \dots, P_m$ 
    of $R$ and $n_i \in \N$ such that 
    \[ R \cong R/P_1^{n_1} \times \cdots \times R/P_m^{n_m}. \] 
\end{prop}\vspace{-0.25cm}

Note that if $R$ is an integral domain, then this proposition tells us 
almost nothing as we can simply take $P_1 = \{0\}$. This is much 
more interesting when we are not working with integral domains.

\begin{pf}[Proposition~\ref{prop:3.7}]
    We can find prime ideals $Q_1, \dots Q_k$ of $R$ such that 
    $Q_1Q_2 \cdots Q_k = \{0\}$ by using Proposition~\ref{prop:3.2}
    with $I = \{0\}$ and noting that finite rings are Noetherian. 
    Grouping the $Q_i$'s with multiplicity, we can write 
    \[ P_1^{n_1} \cdots P_m^{n_m} = \{0\} \] 
    where $P_i \neq P_j$ for $i \neq j$. Note that each $P_i$ is prime, 
    so $R/P_i$ is a finite integral domain and hence a field. This 
    means that $P_i$ is also maximal. So we have $P_i + P_j = R$ 
    for $i \neq j$ because these are each independently maximal and distinct,
    and hence any bigger ideal must be the whole ring. By Proposition~\ref{prop:3.4},
    we obtain $P_i^{n_i} + P_j^{n_j} = R$, and the generalized Chinese 
    remainder theorem (Theorem~\ref{theo:3.6}) gives 
    \[ R \cong R/P_1^{n_1} \cdots P_m^{n_m} \cong R/P_1^{n_1} \times 
    \cdots \times R/P_n^{n_m}. \eqno\qed \]
\end{pf}

\subsection{Prime Ideals of the Ring of Integers} \label{subsec:3.2}
Let $K$ be a number field of degree $[K : \Q] = n$, and let $R = {\cal O}_K$.
Let $I$ be a nonzero proper ideal of $R$. We know the following facts: 
\begin{enumerate}[(1)]
    \item Corollary~\ref{cor:1.19}: $R/I$ is finite, which allows us to 
    apply Proposition~\ref{prop:3.7}.
    \item Corollary~\ref{cor:1.21}: $R$ is Noetherian, so we can apply 
    Proposition~\ref{prop:3.2}.
    \item {\bf Correspondence theorem for rings.} There is a one-to-one
    correspondence between the ideals of $R$ that contain $I$ and the 
    ideals of the quotient ring $R/I$. In other words, every ideal $\overline{J}$ 
    of $R/I$ is of the form $\overline{J} = J/I$, where $J \subseteq R$ 
    is an ideal such that $I \subseteq J$. Moreover, $\overline{J}$ 
    is prime if and only if $J$ is prime. 
    \item Since $R/I$ is finite, we have by (3), Proposition~\ref{prop:3.7},
    and the third isomorphism theorem that 
    \begin{align*}
        R/I &\cong (R/I)/(P_1^{n_1}/I) \times \cdots \times (R/I)/(P_m^{n_m}/I) \\ 
        &\cong R/P_1^{n_1} \times \cdots \times R/P_m^{n_m} 
    \end{align*}
    where each $P_i \subseteq R$ is prime and $I \subseteq P_i$. 
\end{enumerate}
Therefore, to understand the ideal $I$, we study the prime ideals $P \supseteq I$. 
It turns out that $P \supseteq I$ if and only if $P$ is a ``prime factor'' of $I$,
as we'll see later in the course. 

For now, we'll introduce a couple of big ideas. Note that by the correspondence 
theorem, the prime ideals of $R/I$ are precisely $P/I$ where $P \supseteq I$ 
is a prime ideal. Moreover, for a prime ideal $P \supseteq I$, we know that 
$R/P$ is a finite field, so its cardinality is $|R/P| = p^m$
for some prime number $p \in \N$. This tells us that 
\[ p^m + P = p^m(1 + P) = 0 + P \] 
where the last equality is by Lagrange. Then $p^m \in P$. Since $P$ 
is a prime ideal, we get $p \in P$ and so $\langle p \rangle \subseteq P$. 

Next, we go through a computational example. Let $K = \Q(\sqrt{2})$ 
and let $R = {\cal O}_K = \Z[\sqrt{2}]$. Let's try to find all the 
prime ideals $P$ such that $\langle 5 \rangle \subseteq P$ 
(or equivalently, $5 \in P$). We have the isomorphisms 
\[ R/\langle 5 \rangle = \Z[\sqrt{2}]/\langle 5 \rangle 
\cong \Z[x]/\langle x^2 -2, 5 \rangle \cong \Z_5[x] / \langle x^2 -2 \rangle. \] 
Note that $x^2 - 2$ is irreducible over $\Z_5[x]$ because it has no roots. 
So $\langle x^2 - 2 \rangle$ is a maximal ideal of $\Z_5[x]$ and hence 
$R/\langle 5 \rangle \cong \Z_5[x]/\langle x^2 - 2 \rangle$ is a field. 
This tells us that $\langle 5 \rangle \subseteq R$ is maximal, so 
the only prime ideal $P$ of $R$ sitting above $\langle 5 \rangle$ is 
$P = \langle 5 \rangle$ itself. 

That was rather simple, so let's keep going. Take $K = \Q(\sqrt{2})$ 
and $R = {\cal O}_K = \Z[\sqrt{2}]$ as before. Now, let's try to 
find the prime ideals such that $\langle 7 \rangle \subseteq P$. We have 
the isomorphisms 
\[ R/\langle 7 \rangle \cong \Z[x]/\langle x^2 - 2, 7 \rangle 
\cong \Z_7[x]/\langle x^2 - 2 \rangle, \] 
but this time, we have $x^2 - 2 = (x+3)(x+4)$ over $\Z_7[x]$. Then 
the Chinese remainder theorem implies that 
\[ \Z_7[x]/\langle x^2 - 2 \rangle \cong \Z_7[x]/\langle x+3\rangle 
\times \Z_7[x]/\langle x+4 \rangle \cong \Z_7 \times \Z_7, \] 
where the last isomorphism is obtained by sending $x$ to $-3$ and $-4$ 
respectively (or we can formally justify this using the first isomorphism
theorem if we'd like). 

The prime ideals of $\Z_7 \times \Z_7$ are 
$P_1 = \langle (1, 0) \rangle$ and $P_2 = \langle (0, 1) \rangle$. 
Our goal now is to retrace our isomorphisms backwards. We have 
\begin{align*}
    (1, 0) \in \Z_7 \times \Z_7 
    &\mapsto (1 + \langle x+3 \rangle, 0 + \langle x+4 \rangle) \in \Z_7[x]/\langle x+3\rangle 
    \times \Z_7[x]/\langle x+4 \rangle \\ 
    &\mapsto x+4 + \langle x^2 + 2 \rangle \in \Z_7[x]/\langle x^2 - 2 \rangle \\ 
    &\mapsto x+4 + \langle x^2 - 2, 7 \rangle \in \Z[x]/\langle x^2 - 2, 7 \rangle \\ 
    &\mapsto \sqrt{2} + 4 + \langle 7 \rangle \in R/\langle 7 \rangle. 
\end{align*}
The trickiest one to reverse here is the second one: we needed to reverse 
the map from the Chinese remainder theorem. We needed to find a polynomial 
that was congruent to $1$ mod $x+3$ and congruent to $0$ mod $x+4$, 
and $x+4$ happened to do the trick. Similarly, we have 
\begin{align*}
    (0, 1) \in \Z_7 \times \Z_7 
    &\mapsto (0 + \langle x+3 \rangle, 1 + \langle x+4 \rangle) \in \Z_7[x]/\langle x+3\rangle 
    \times \Z_7[x]/\langle x+4 \rangle \\ 
    &\mapsto -x-3 + \langle x^2 + 2 \rangle \in \Z_7[x]/\langle x^2 - 2 \rangle \\ 
    &\mapsto -x-3 + \langle x^2 - 2, 7 \rangle \in \Z[x]/\langle x^2 - 2, 7 \rangle \\ 
    &\mapsto -\sqrt{2} - 3 + \langle 7 \rangle \in R/\langle 7 \rangle, 
\end{align*}
where $-x-3$ is congruent to $0$ mod $x+3$ and congruent to $1$ mod $x+4$. 
Thus, the prime ideals in $R$ containing $7$ are $Q_1 = \langle \sqrt{2} + 4, 7
\rangle$ and $Q_2 = \langle -\sqrt{2} - 3, 7 \rangle = \langle 2+\sqrt{3}, 7 \rangle$, 
keeping in mind that we are looking for the prime ideals of $R$ and not those 
of $R/\langle 7 \rangle$. Note that we have $(\sqrt{2} + 3)(\sqrt{2} - 3) = -7$
so we in fact have $Q_2 = \langle 2 + \sqrt{3} \rangle$. However, it doesn't 
hurt to include the $7$ to ensure that it is actually living above 
$\langle 7 \rangle$.

The main takeaways of this computation were as follows: 
\begin{enumerate}[(1)]
    \item The minimal polynomial $x^2 - 2$ factored as $(x+3)(x+4)$ over $\Z_7$. 
    \item We have $(\sqrt{2} + 3)(\sqrt{2} + 4) = 14 + 7\sqrt{2}$; the coefficients 
    are both divisible by $7$. 
    \item By (2), we have $Q_1Q_2 \subseteq \langle 7 \rangle$. 
    It can be checked that $Q_1Q_2 = \langle 7 \rangle$ is the prime 
    factorization of $\langle 7 \rangle$.
\end{enumerate}

We'll do one more example. This time, we find the prime ideals such 
that $P \supseteq \langle 2 \rangle$. We have the isomorphisms 
\begin{align*}
    R/\langle 2 \rangle \cong \Z[x]/\langle x^2-2, 2 \rangle 
    \cong \Z_2[x]/\langle x^2 \rangle.
\end{align*}
Since this quotient ring only consists of $4$ elements, let's just look 
at the elements explicitly. Let $P$ be a prime ideal of $\Z_2[x]/\langle x^2 \rangle$. 
Being an ideal, we must have $0 + \langle x^2 \rangle \in P$. But $P$ 
is proper, so $1 + \langle x^2 \rangle \notin P$. Since 
$(x+1 + \langle x^2 \rangle)^2 = 1 + \langle x^2 \rangle \notin P$,
we must have $x+1 + \langle x^2 \rangle \notin P$ for otherwise $P$ 
would not be closed under multiplication by $\Z_2[x]/\langle x^2 \rangle$.
Also, note that $P$ cannot be the zero ideal $\{0 + \langle x^2 \rangle\}$ since 
$\Z_2[x]/\langle x^2 \rangle$ is not an integral domain. Therefore, we must have 
\[ P = \langle x + \langle x^2 \rangle \rangle = \{0 + \langle x^2 \rangle, 
x + \langle x^2 \rangle\}. \] 
Retracing isomorphisms, we have 
$x + \langle x^2 \rangle \mapsto x + \langle x^2-2, 2 \rangle \mapsto 
\sqrt{2} + \langle 2 \rangle$.
It follows that $Q = \langle \sqrt{2}, 2 \rangle = \langle \sqrt{2} \rangle$ 
is the only prime ideal of $R$ such that $2 \in Q$. Note that 
$\langle 2 \rangle = \langle \sqrt{2} \rangle^2$ here.

One observation here is that $\disc(K) = 8$ and $p \mid 8$ if and only if 
$p = 2$. As we'll see later, the primes that divide the discriminant 
are the only ones with multiplicity in their ideal prime factorization. 

We state a fact relating the minimal polynomial of $\alpha$ and the 
ideal prime factorization of $\langle p \rangle$ where $p$ is prime, 
under the strong assumption that ${\cal O}_K = \Z[\alpha]$.  
We'll prove this later, but we require a lot of machinery first.

\begin{theo}{theo:3.8}
    Let $K$ be a number field with $[K : \Q] = n$ where $K = \Q(\alpha)$
    for some $\alpha \in \C$. 
    Assume that ${\cal O}_K = \Z[\alpha]$. Let $m(x) \in \Z[x]$ be the 
    minimal polynomial for $\alpha$. If $p \in \N$ is prime and $m(x)$ 
    factors over $\Z_p[x]$ as 
    \[ \bar{m}(x) = q_1(x)^{n_1} \cdots q_k(x)^{n_k} \in \Z_p[x] \] 
    where $q_i(x) \neq q_j(x)$ for $i \neq j$ and each $q_i(x)$ is irreducible, then 
    \begin{enumerate}[(1)]
        \item the prime ideals $P \subseteq {\cal O}_K$ such that $p \in P$ 
        are exactly $P = \langle q_i(\alpha), p \rangle$; and 
        \item we have $\langle p \rangle = \langle q_1(\alpha), p \rangle^{n_1}
        \cdots \langle q_k(\alpha), p \rangle^{n_k}$. 
    \end{enumerate} 
\end{theo}\vspace{-0.25cm}

In particular, this fact gives us all the prime ideals as well as how 
to do the ideal prime factorization! 

For example, suppose that $\alpha \in \C$ satisfies $\alpha^2 + \alpha + 1 = 0$. 
Note that ${\cal O}_{\Q(\alpha)} = \Z[\alpha]$ because 
$\disc(x^2 + x + 1) = -3$ is squarefree. The minimal 
polynomial of $\alpha$ is $m(x) = x^2 + x + 1$. Over $\Z_3[x]$, this factors as 
\[ \bar{m}(x) = (x+2)(x+2) \in \Z_3[x], \] 
so by Theorem~\ref{theo:3.8}, we have $\langle 3 \rangle = \langle \alpha + 2, 3 \rangle^2$ 
and that $\langle \alpha + 2, 3 \rangle$ is a prime ideal of ${\cal O}_K$. 
On the other hand, $x^2 + x + 1$ is irreducible over $\Z_2[x]$ and so 
the prime factorization of $\langle 2 \rangle$ is just itself since 
$\langle \alpha^2 + \alpha + 1, 2 \rangle = \langle 2 \rangle$.

\subsection{Dedekind Domains} \label{subsec:3.3}
Dedekind domains are the rings where ideal prime factorization happens! 
Before we give the definition, we'll give some motivation for the 
desired properties.

Let $R \subseteq S$ be integral domains. 
\begin{enumerate}[(1)]
    \item Recall that $\alpha \in S$ is {\bf integral} over $R$ 
    (see Definition~\ref{defn:1.6}) if there exists a monic polynomial 
    $f(x) \in R[x]$ such that $f(\alpha) = 0$. By Theorem~\ref{theo:1.7},
    this is equivalent to $R[\alpha]$ being finitely generated as an $R$-module.
    \item We say that $S$ is {\bf integral} over $R$ if all elements of 
    $S$ are integral over $R$. 
\end{enumerate}

We now introduce a few more related definitions.

\begin{defn}{defn:3.9}
    Let $R \subseteq S$ be integral domains. 
    \begin{enumerate}[(1)]
        \item The {\bf integral closure} of $R$ in $S$ is 
        $\{\alpha \in S : \alpha \text{ is integral over } R\}$.
        \item We say that $R$ is {\bf integrally closed} if the integral 
        closure of $R$ in its field of fractions is $R$ itself. 
    \end{enumerate}
\end{defn}\vspace{-0.25cm}

For example, we see that $\Z$ is integrally closed because its field 
of fractions is $\Q$, and the only algebraic integers in $\Q$ 
are the ordinary integers.

Consider a number field $K$ and let $R = {\cal O}_K$ be its ring of 
integers. Let $F$ be the field of fractions of $R$. Note that 
if $x \in K$, there exists $0 \neq N \in \Z$ such that $Nx \in R$ 
by part (a) of \ref{A1-1}. This means that $x \in F$, and thus $K = F$. 
So the field of fractions of the ring of integers is precisely the number field.

\begin{prop}{prop:3.10}
    Let $K$ be a number field. Then ${\cal O}_K$ is integrally closed. 
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:3.10}]
    We give a sketch of the proof up to writing down some generating sets.
    Suppose that $\alpha \in K$ is in the integral closure of ${\cal O}_K$, so 
    there exists some monic polynomial 
    \[ f(x) = x^n + a_{n-1} x^{n-1} + \cdots + a_0 \in {\cal O}_K[x] \] 
    with $f(\alpha) = 0$. Since $a_i \in {\cal O}_K$ 
    (i.e. $a_i$ is integral over $\Z$), it follows from Theorem~\ref{theo:1.7}
    that $\Z[a_i]$ is a finitely generated $\Z$-module. This implies that 
    $\Z[a_{n-1}, a_{n-2}, \dots, a_0]$ is also finitely generated. 
    But we can write 
    \[ \alpha^n = -a_{n-1} \alpha^{n-1} - \cdots - a_1\alpha - a_0, \] 
    so $\Z[\alpha, a_{n-1}, \dots, a_1, a_0]$ is also finitely generated. 
    Note that $\Z[\alpha] \subseteq \Z[\alpha, a_{n-1}, \dots, a_1, a_0]$.
    Since $\Z$ is Noetherian, we have by Theorem~\ref{theo:1.10} that 
    $\Z[\alpha]$ is also finitely generated, so $\alpha \in {\cal O}_K$
    by Theorem~\ref{theo:1.7}. \qed
\end{pf}\vspace{-0.25cm}

With this result, we are now ready to state the definition of a Dedekind domain. 

\begin{defn}{defn:3.11}
    Let $R$ be an integral domain. We say that $R$ is a {\bf Dedekind domain} if 
    \begin{enumerate}[(1)]
        \item $R$ is Noetherian;
        \item $R$ is integrally closed; and 
        \item every nonzero prime ideal of $R$ is maximal.
    \end{enumerate}
\end{defn}\vspace{-0.25cm}

In particular, we see that ${\cal O}_K$ satisfies all three of these 
properties (by Corollary~\ref{cor:1.21}, Proposition~\ref{prop:3.10}, 
and Corollary~\ref{cor:1.20} respectively). 

Why is this definition of a Dedekind domain the right one 
for prime factorization? 
\begin{enumerate}[(1)]
    \item Being Noetherian gives us the existence of prime 
    factorization by using the classic Noetherian contradiction proof technique.
    \item Because every nonzero prime is maximal, primes can't be factored further.
    \item It turns out that being integrally closed will give us the uniqueness 
    of prime factorization!
\end{enumerate}
Now, our goal is to explore the connection between being integrally closed 
and prime factorization. The following lemma will be a useful ``contradiction 
getter'' soon. In particular, if $\lambda \in F \setminus R$ is a root of a 
monic polynomial with coefficients in $R$, this will contradict the 
fact that $R$ is integrally closed.

\begin{lemma}{lemma:3.12}
    Let $R$ be a Dedekind domain, let $I$ be a nonzero proper ideal, and 
    let $F$ be the field of fractions of $R$. Then there exists 
    $\lambda \in F \setminus R$ such that $\lambda I \subseteq R$.     
\end{lemma}\vspace{-0.25cm}
\begin{pf}[Lemma~\ref{lemma:3.12}]
    Let $0 \neq a \in I$. Note that $R$ is Noetherian since it is a Dedekind 
    domain, so by Proposition~\ref{prop:3.2}, we can find nonzero 
    prime ideals $P_1, \dots, P_r$ of $R$ such that $P_1 P_2 \cdots P_r 
    \subseteq \langle a \rangle$. Moreover, assume that $r$ is minimal
    (i.e. pick the smallest number of prime ideals possible). Let 
    $M$ be a maximal ideal such that $I \subseteq M$. 

    Since $P_1 P_2 \cdots P_r \subseteq I \subseteq M$ and $M$ is prime, 
    it follows by the ideal-wise characterization of a prime ideal 
    that there is some $i \in \{1, \dots, r\}$ with $P_i \subseteq M$. 
    Without loss of generality, assume that $P_1 \subseteq M$. Note that 
    $P_1$ is prime and hence maximal since $R$ is a Dedekind domain, so 
    $P_1 = M$. 

    {\bf Case 1.} If $r = 1$, then $P_1 \subseteq \langle a \rangle 
    \subseteq I \subseteq M = P_1$ and we get equality throughout. 
    This gives us $I = \langle a \rangle$, so we can take 
    $\lambda = 1/a \in F \setminus R$ (where we know $a$ is not a unit 
    for otherwise $I = R$).

    {\bf Case 2.} If $r > 1$, then by the minimality of $r$, there exists 
    some element $b \in P_2 \cdots P_r \setminus \langle a \rangle$. Then we have 
    $bP_1 \subseteq P_1 P_2 \cdots P_r \subseteq \langle a \rangle$. Moreover, we see that 
    $bI \subseteq bM = bP_1 \subseteq \langle a \rangle$, so we may 
    take $\lambda = b/a$. Note that this works because if $x \in I$, then 
    $\lambda x = \frac{b}{a} x$. But $bx \in I \subseteq \langle a \rangle$, 
    so we can write $bx = ar$ for some $r \in R$, giving us $\lambda x = 
    \frac{ar}{a} = r \in R$. Also, since $b \notin \langle a \rangle$, 
    we have $\lambda \notin R$ as well. \qed 
\end{pf}\vspace{-0.25cm}

Equipped with this ``contradiction getter'', we can prove an extremely useful result
using the integrally closed property of a Dedekind domain. 

\begin{prop}{prop:3.13}
    Let $R$ be a Dedekind domain, and let $I$ be a nonzero proper ideal. 
    Then there exists a nonzero ideal $J$ of $R$ such that $IJ$ is principal.
\end{prop}\vspace{-0.25cm}\newpage 
\begin{pf}[Proposition~\ref{prop:3.13}]
    Let $0 \neq a \in I$ and consider the nonzero ideal 
    \[ J = \{x \in R : xI \subseteq \langle a \rangle\}. \] 
    We already know it is nonzero because $a \in J$, so just verify the ideal 
    properties. 
    
    Note that $IJ \subseteq \langle a \rangle$. Consider the ``fractional ideal'' 
    $A = \frac1a IJ \subseteq R$ (this trick will come up a lot). If $A = R$, 
    then $IJ = aR = \langle a \rangle$ and we are already done. 

    Now suppose that $A \neq R$. We'll show that this case is actually impossible. 
    We leave it as an exercise that $A$ is a nonzero ideal of $R$. Then by 
    Lemma~\ref{lemma:3.12}, there exists $\lambda \in F \setminus R$ 
    such that $\lambda A \subseteq R$, where $F$ is the field of 
    fractions of $R$. 

    Notice that $J = \frac1a aJ \subseteq A$ since $a \in I$, and so 
    $\lambda J \subseteq \lambda A \subseteq R$. Moreover, if we write 
    $\lambda A = \frac{\lambda}{a} IJ \subseteq R$, then multiplying 
    both sides by $a$ gives us $\lambda IJ \subseteq aR = \langle a \rangle$. 
    In particular, we can regroup $\lambda IJ$ as $(\lambda J)I$ by 
    commutativity with $(\lambda J)I \subseteq \langle a \rangle$, and we see 
    by the definition of $J$ that $\lambda J \subseteq J$.

    Since $R$ is Noetherian, $J$ is finitely generated, say by 
    $\alpha_1, \dots, \alpha_n$. We can find $B \in M_m(R)$ such that 
    \[ \begin{bmatrix} \lambda\alpha_1 \\ \vdots \\ \lambda\alpha_m \end{bmatrix} 
    = B \begin{bmatrix} \alpha_1 \\ \vdots \\ \alpha_m \end{bmatrix}. \] 
    Note that $(\alpha_1, \dots, \alpha_m)^T$ is nonzero and rearranging 
    the above gives us 
    \[ (\lambda I - B) \begin{bmatrix} \alpha_1 \\ \vdots \\ \alpha_m \end{bmatrix}
    = 0. \] 
    This means that $\lambda I - B$ is not invertible, and so 
    $\det(\lambda I - B) = 0$. But $\det(xI - B)$ is the characteristic 
    polynomial of $B$; in particular, it is a monic polynomial with coefficients 
    in $R$ having $\lambda$ as a root. This is a contradiction because 
    $\lambda \notin R$ and $R$ is integrally closed. \qed
\end{pf}\vspace{-0.25cm}

By Proposition~\ref{prop:3.13} and what we proved in \ref{A2-3}, it now 
makes sense to make the following definition. We won't be using this 
immediately, but it will come up later in the course.

\begin{defn}{defn:3.14}
    Let $R$ be a Dedekind domain and let $X$ be the set of nonzero ideals of $R$. 
    Put an equivalence relation on $X$ by $I \sim J$ if and only if 
    there exist $\alpha, \beta \in R \setminus \{0\}$ such that 
    $\alpha I = \beta J$. Then 
    \[ G := \{ [I] : I \in X \} \] 
    is a group under the operation $[I][J] = [IJ]$, called the {\bf ideal 
    class group} of $R$. The identity is the equivalence class of 
    principal ideals. 
\end{defn}\vspace{-0.25cm}

The following result, which we will call cancellation of ideals, is our 
best friend for proving the uniqueness of prime factorization! 
It allows us to inductively chop off ideals. 

\begin{prop}[Cancellation of Ideals]{prop:3.15}
    Let $R$ be a Dedekind domain. Let $A$, $B$, and $C$ be nonzero ideals. 
    If $AB = AC$, then $B = C$. 
\end{prop}\vspace{-0.25cm}\newpage
\begin{pf}[Proposition~\ref{prop:3.15}]
    By Proposition~\ref{prop:3.13}, we can find a nonzero ideal $J$ 
    such that $JA = \langle a \rangle$ for some $0 \neq a \in R$. We have 
    $AB = AC$, and multiplying by $J$ gives us 
    $\langle a \rangle B = JAB = JAC = \langle a \rangle C$. 
    Then $aB = aC$, and hence $B = C$ since $R$ is an integral domain. \qed
\end{pf}\vspace{-0.25cm}

The following definition is a very natural one to make. 

\begin{defn}{defn:3.16}
    Let $R$ be a ring and let $A$ and $B$ be ideals of $R$. We say that 
    $A$ {\bf divides} $B$, written $A \mid B$, if there exists an 
    ideal $C$ such that $B = AC$. 
\end{defn}\vspace{-0.25cm}

The next result tells us that in a Dedekind domain, the factors of a 
ideal are precisely the ideals living above. 

\begin{prop}{prop:3.17}
    Let $R$ be a Dedekind domain. Let $A$ and $B$ be nonzero proper ideals of $R$. 
    Then $A \mid B$ if and only if $B \subseteq A$. 
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:3.17}]
    $(\Rightarrow)$ If $A \mid B$, then $B = AC$ for some ideal $C$ and $AC \subseteq A$.

    $(\Leftarrow)$ Suppose that $B \subseteq A$. By Proposition~\ref{prop:3.13},
    we can find a nonzero ideal $J$ such that $JA = \langle a \rangle$ for some 
    $0 \neq a \in R$. Note that $JB \subseteq JA = \langle a \rangle$. 
    Consider the fractional ideal $C = \frac1a JB$ (verify that this is 
    indeed an ideal of $R$). Note that $JAC = \langle a \rangle \frac1a JB = JB$,
    so by ideal cancellation (Proposition~\ref{prop:3.15}), we have 
    $AC = B$ and thus $A \mid B$. \qed
\end{pf}\vspace{-0.25cm}

We are ready to prove the golden result that every nonzero proper ideal 
of a Dedekind domain can be uniquely factored into primes. Note that $\{0\}$ 
is prime but cannot be uniquely factored, while $R$ does not have a prime 
factorization because no primes can live above it. 

\begin{theo}{theo:3.18}
    Let $R$ be a Dedekind domain and let $I$ be a nonzero proper ideal. 
    Then $I$ can be written uniquely (up to reordering) as a product 
    of prime ideals. 
\end{theo}\vspace{-0.25cm}
\begin{pf}[Theorem~\ref{theo:3.18}]
    {\bf Existence.} We use the Noetherian contradiction method 
    we alluded to before. Let $X$ be the set of proper nonzero ideals of $R$ 
    which cannot be written as a product of prime ideals. Suppose that 
    $X \neq \varnothing$. Let $I \in X$ be maximal (with respect to 
    $\subseteq$). Then $I$ is not a prime ideal and hence not a maximal ideal 
    (since being prime is the same as being maximal in a Dedekind domain).
    Let $P$ be a maximal ideal such that $I \subsetneq P$. By 
    Proposition~\ref{prop:3.17}, we have $P \mid I$, so there exists an ideal 
    $J$ such that $I = PJ$.

    Note that $I = PJ \subseteq J$. If $I = J$, then $I = IR = IP$.
    Cancellation of ideals (Proposition~\ref{prop:3.15}) implies that 
    $P = R$, which is a contradiction since prime ideals are proper. Therefore, 
    we must have $I \subsetneq J$. 
    By the maximality of $I$ in $X$, we have $J \notin X$, so $J$ 
    can be written as a product of primes. Then $I = PJ$ is also a product 
    of primes, which is a contradiction! So $X = \varnothing$ and 
    every nonzero proper ideal of $R$ can be written as a product of 
    prime ideals.

    {\bf Uniqueness.} Suppose that $I = P_1P_2 \cdots P_n = Q_1Q_2 \cdots Q_m$ 
    where $P_i$ and $Q_j$ are prime ideals. Note that 
    \[ Q_1 Q_2 \cdots Q_m = P_1 P_2 \cdots P_n \subseteq P_1. \] \newpage
    Since $P_1$ is prime, we have (without loss of generality) that 
    $Q_1 \subseteq P_1$. But $Q_1$ is prime and hence maximal, so 
    $Q_1 = P_1$. Then by ideal cancellation, we obtain 
    \[ P_2 \cdots P_n = Q_2 \cdots Q_m. \] 
    Continuing inductively, we find that $P_i = Q_i$ (up to reordering) 
    and $n = m$. \qed 
\end{pf}

\subsection{Ideal Norm} \label{subsec:3.4}
In the previous section, we proved that every nonzero proper ideal of a 
Dedekind domain has a unique prime factorization, which is great. 
But \emph{how} do we actually find such a prime factorization?

Let's start by proposing a potential tool we could use. 

\begin{defn}{defn:3.19}
    Let $K$ be a number field and let $R = {\cal O}_K$ be its ring of integers. 
    The {\bf norm} of a nonzero ideal $I$ is 
    \[ N(I) := |R/I|. \] 
\end{defn}\vspace{-0.25cm}
Note that this is always finite because $R/I$ is finite by Corollary~\ref{cor:1.19}.

Assume for now that the ideal norm is multiplicative; that is, 
$N(IJ) = N(I)N(J)$ for nonzero ideals $I$ and $J$. Suppose that 
$n = N(I) = |R/I|$. We know from Theorem~\ref{theo:3.18} that $I$ has a 
unique prime factorization $I = P_1^{n_1} \cdots P_k^{n_k}$. Using our
assumption that the ideal norm is multiplicative, we have 
\[ N(I) = N(P_1)^{n_1} \cdots N(P_k)^{n_k}. \] 
But we previously saw that $N(P_i) = |R/P_i| = p_i^{m_i}$ where 
$p_i \in \N$ is prime with $p_i \in P_i$. For a prime $p \in \N$ 
such that $p \mid n$, it must be the case that $p = p_i$ for some $i \in 
\{1, \dots, k\}$. Then $p \in P_i$ implies that $\langle p \rangle 
\subseteq P_i$, so $P_i \mid \langle p \rangle$ by Proposition~\ref{prop:3.17}.
So if we could factor each $\langle p_i \rangle$, then we could find 
candidates for the $P_i$'s and factor $I$. The value of $N(I)$ could 
help us to find the $n_i$'s as well. 

Therefore, we have two goals in mind: 
\begin{enumerate}[(1)]
    \item Prove that the ideal norm is multiplicative.
    \item Show that $\langle p \rangle$ is easily factored for ``almost all''
    primes $p \in \N$ (namely, we get something similar to 
    Theorem~\ref{theo:3.8} in most cases).
\end{enumerate}
Let's work towards the first goal. Suppose that $I = P_1^{n_1} \cdots P_k^{n_k}$
where $P_i$ are distinct prime ideals (so $P_i$ and $P_j$ are pairwise coprime
for $i \neq j$). Then the Chinese remainder theorem (Theorem~\ref{theo:3.6})
gives us 
\[ R/I \cong R/P_1^{n_1} \times \cdots \times R/P_k^{n_k}, \] 
and thus $N(I) = N(P_1^{n_1}) \cdots N(P_k^{n_k})$. Therefore, to 
prove that the ideal norm is multiplicative, it is enough to show that 
$N(P_i^{n_i}) = N(P_i)^{n_i}$. This innocent looking result requires a 
lot of machinery, namely localization, local rings, and discrete valuation rings.

To end this section, we prove a useful relationship between the ideal norm 
of a principal ideal and the field norm.
Let $\{v_1, \dots, v_n\}$ be an integral basis for $R = {\cal O}_K$ 
and recall that a nonzero ideal $I$ of $R$ has an integral basis 
$\{w_1, \dots, w_n\}$ because of Corollary~\ref{cor:1.17}. By taking 
$M = R$ and $N = I$ in \ref{A2-4}, we obtain 
\begin{align*}
    \disc(w_1, \dots, w_n) &= [R : I]^2 \cdot \disc(v_1, \dots, v_n) \\ 
    &= N(I)^2 \cdot \disc(v_1, \dots, v_n).
\end{align*}
If $I = \langle \alpha \rangle$ where $\alpha \neq 0$, then 
$w_i = \alpha v_i$ is an integral basis for $I$. (Linear independence 
comes from $R$ being an integral domain, and spanning comes from 
the fact that $I = \alpha R$.) Our calculation above shows that 
\[ \disc(\alpha v_1, \dots, \alpha v_n) = N(I)^2 \cdot \disc(K). \] 
On the other hand, we can also see that 
\begin{align*}
    \disc(\alpha v_1, \dots, \alpha v_n) 
    &= \det\,[\sigma_i(\alpha v_j)]^2 \\ 
    &= \det\,[\sigma_i(\alpha) \sigma_i(v_j)]^2 \\ 
    &= (\sigma_1(\alpha) \cdots \sigma_n(\alpha))^2 \cdot \det\,[\sigma_i(v_j)]^2 \\ 
    &= N_{K/\Q}(\alpha)^2 \cdot \disc(K). 
\end{align*}
In particular, we have $N(I)^2 = N_{K/\Q}(\alpha)^2$ and thus 
\[ N(\langle \alpha \rangle) = |N_{K/\Q}(\alpha)|. \] 

\subsection{Localization} \label{subsec:3.5}
We introduce local rings, which will lead us to the notion of localization.

\begin{defn}{defn:3.20}
    A {\bf local ring} is a ring which has a unique maximal ideal.
\end{defn}\vspace{-0.25cm}

The following is a useful characterization of a local ring. 

\begin{prop}{prop:3.21}
    A ring $R$ is local if and only if $I = R \setminus R^\times$ is an 
    ideal of $R$. In this case, $I$ is the unique maximal ideal. 
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:3.21}]
    $(\Rightarrow)$ Let $R$ be a local ring and $M$ be a maximal ideal of $R$. 
    Note that $M \subseteq I$ because maximal ideals are proper and cannot 
    contain units. Conversely, if $\alpha \in I$, we see that $\langle \alpha \rangle$ 
    is proper. But $M$ is the unique maximal ideal, so $\langle \alpha \rangle 
    \subseteq M$ and thus $I \subseteq M$. 

    $(\Leftarrow)$ Suppose that $I = R \setminus R^\times$ is an ideal of $R$. 
    Then for all maximal ideals $M$, we have $M \subseteq I$. But $M$ 
    being maximal means that $M = I$. \qed 
\end{pf}\vspace{-0.25cm}

Every field $F$ is a local ring because the units 
are $F^\times = F \setminus \{0\}$, and $F \setminus F^\times = \{0\}$ 
is the only maximal ideal. 

Another example of a local ring is $\Z_{p^n}$ where $n > 1$. Indeed, 
observe that $x \notin \Z_{p^n}^\times$ if and only if $\gcd(x, p^n) \neq 1$. 
In particular, the non-units are the multiples of $p$, which form 
an ideal. 

However, this is not the type of example that we want. How can we 
construct local integral domains? The answer is localization!

\begin{defn}{defn:3.22}
    Let $R$ be an integral domain, let $K$ be the field of fractions of $R$, 
    and let $P$ be a prime ideal of $R$. The {\bf localization} of $R$ 
    at $P$ is defined to be
    \[ R_P = \left\{\frac{a}{b} \in K : b \notin P \right\}. \] 
\end{defn}\vspace{-0.25cm}

Let's make a few remarks about the localization by a prime ideal. 
\begin{enumerate}[(1)]
    \item Note that we are using lazy notation here; it is possible to have 
    $\frac{a}{b} \in R_P$ where $b \in P$. We only require the existence 
    of elements $c, d \in R$ such that $\frac{a}{b} = \frac{c}{d}$ where $d \notin P$. 
    For a simple example, take $R = \Z$ and $P = \langle 2 \rangle$. 
    Observe that we have $\frac{4}{6} = \frac{2}{3} \in \Z_{\langle 2 \rangle}$
    even though $6 \in \langle 2 \rangle$. 

    \item Let $\frac{a}{b}, \frac{c}{d} \in K$ where $b, d \notin P$. Note that 
    $bd \notin P$ since $P$ is a prime ideal, so $\frac{a}{b} + \frac{c}{d} 
    = \frac{ad+bc}{bd} \in R_P$ and $\frac{a}{b} \cdot \frac{c}{d} = \frac{ac}{bd} \in R_P$. 
    In particular, $R_P$ is a subring of $K$. 

    \item It is clear that $PR_P$ is an ideal of $R$. We show that 
    $PR_P = R_P \setminus R_P^\times$ and so $R_P$ is a local ring by 
    Proposition~\ref{prop:3.21}. 
    (It better be if we're going to call it the localization!)
    
    First, we show that every element of $R_P \setminus PR_P$ is a unit. 
    Let $\frac{a}{b} \in R_P$ where $b \notin P$, and suppose that $\frac{a}{b} 
    \notin PR_P$. Note that $a \notin P$ for otherwise $\frac{a}{b} = \frac{a}{1} 
    \frac{1}{b} \in PR_P$ by definition. This implies that $\frac{b}{a} \in R_P$ 
    and so $\frac{a}{b}$ is a unit. 

    On the other hand, every element of $PR_P$ is not a unit. Let 
    $\frac{a}{b} \in P$ where $a \in P$ and $b \notin P$, and let 
    $\frac{c}{d} \in R_P$ where $c \in R$ and $d \notin P$. Suppose 
    by way of contradiction that $\frac{a}{b} \cdot \frac{c}{d} = \frac{1}{1}$.
    Then there must exist some $u \notin P$ such that $uac = ubd$. But this is 
    a contradiction because $uac \in P$, but $ubd \notin P$. 

    We denote the unique maximal ideal $PR_P$ by $P_P = 
    \{\frac{a}{b} : a \in P,\, b \notin P\}$. 
\end{enumerate}

We have now shown that if $R$ is an integral domain, then $R_P$ is a local ring. 
But what if $R$ is a Dedekind domain? Then $R_P$ is of course local, but 
as we might expect, there is much more!

\subsection{Discrete Valuation Rings} \label{subsec:3.6}
We mentioned discrete valuation rings as another tool we needed to 
prove the multiplicativity of the ideal norm. We now give the definition. 

\begin{defn}{defn:3.23}
    A {\bf discrete valuation ring (DVR)} is an integral domain $R$ such that 
    \begin{enumerate}[(1)]
        \item $R$ is not a field;
        \item $R$ is Noetherian;
        \item $R$ is a local ring;
        \item the unique maximal ideal $M$ of $R$ is principal.
    \end{enumerate}
    If $M = \langle \pi \rangle$, we call $\pi$ a {\bf uniformizer}.
\end{defn}\vspace{-0.25cm}
Our goal is to show that if $R$ is a Dedekind domain and $P$ is a nonzero 
prime ideal, then $R_P$ is a DVR! Note that we are excluding the case 
where $P = \{0\}$ because we would then have $R_P = K$, which is a field 
and hence not a DVR. 

We first prove Nakayama's lemma, which will allow us 
to prove an important property of a DVR.

\begin{lemma}[Nakayama]{lemma:3.24}
    Let $R$ be a ring. Let $I$ be a nonzero proper ideal of $R$ and $M$ 
    be a finitely generated $R$-module such that $IM = M$. There exists 
    $a \in R$ such that 
    \begin{enumerate}[(1)]
        \item $a + I = 1 + I$; and 
        \item $aM = \{0\}$ (that is, $a$ annihilates the module).
    \end{enumerate}
\end{lemma}\vspace{-0.25cm}
\begin{pf}[Lemma~\ref{lemma:3.24}]
    Since $M$ is a finitely generated $R$-module, we can write 
    $M = Rx_1 + \cdots + Rx_n$ for some $x_i \in M = IM$. In particular, 
    each $x_i$ can be written in the form 
    \[ x_i = a_{i1} x_1 + \cdots + a_{in} x_n \] 
    where $a_{ij} \in I$. Let $A = [a_{ij}] \in M_n(I)$ and 
    $v = [x_1, \dots, x_n]^T$ so that $Av = v$. Consider the characteristic 
    polynomial $f(x) = \det(xI_n - A)$ of $A$.
    Note that Cayley-Hamilton holds for commutative rings with unity, so
    $f(A) = 0$. Writing $f(x) = x^n + c_{n-1} x^{n-1} + \cdots + c_1 x + c_0$ 
    where $c_i \in I$, we obtain 
    \begin{align*}
        0 = f(A)v &= (A^n + c_{n-1} A^{n-1} + \cdots + c_1 A + c_0 I_n) v \\ 
        &= v + c_{n-1}v + \cdots + c_1 v + c_0 v \\ 
        &= f(1) v,
    \end{align*}
    where the second equality follows from the fact that $Av = v$. 
    Letting $a = f(1)$, we have $av = 0$, which implies that 
    $ax_i = 0$ for all $i = 1, \dots, n$. But $M = Rx_1 + \cdots + Rx_n$,
    so $aM = \{0\}$. Finally, since $c_i \in I$, we have 
    $a = f(1) = 1 + c_{n-1} + \cdots + c_1 + c_0 \equiv 1 \pmod I$. \qed 
\end{pf}\vspace{-0.25cm}

\begin{prop}{prop:3.25}
    Let $R$ be a DVR and let $M = \langle \pi \rangle$ be its unique maximal ideal. 
    If $I$ is a nonzero proper ideal, then $I = M^n$ for some $n \in \N$. 
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:3.25}]
    Consider the fractional ideal $J = \frac{1}{\pi}R$. (This 
    doesn't live in $R$, but in the field of fractions.) Note that $MJ = R$. 
    Denoting $I_1 = IJ$, we see that $I = IR = IJM = I_1M \subseteq I_1$.
    
    Suppose that $I = I_1$. Then we see that $I = IM$, so by Nakayama's lemma 
    (Lemma~\ref{lemma:3.24}), there exists $a \in R$ such that $a - 1 \in M$ 
    and $aI = \{0\}$. (Note that the roles of $I$ and $M$ are switched; 
    we had some unfortunate notation here.) But $R$ is an integral domain, 
    so the only thing that can kill a nonzero ideal is $a = 0$. This 
    implies that $-1 \in M$ and so $M = R$, which is a contradiction! 
    Therefore, we have $I \subsetneq I_1$. 

    If $I_1 = R$, then $I = I_1 M = RM = M$ and we are done. Otherwise, 
    we have $I_1 \neq R$. Denoting $I_2 = I_1 J$, we see that 
    $I_1 = I_1 R = I_1 J M = I_2 M \subseteq I_2$. An identical argument 
    shows that $I_1 \subsetneq I_2$, and if $I_2 = R$, then 
    $I_1 = M$ and so $I = I_1 M = M^2$. 
    Repeating this process gives us an ascending chain of ideals 
    \[ I \subsetneq I_1 \subsetneq I_2 \subsetneq \cdots \] 
    and since DVRs are Noetherian, this process must terminate. \qed
\end{pf}\vspace{-0.25cm}
Let's take a look at some useful consequences of this proposition.
Let $R$ be a DVR and as usual, let $M = \langle \pi \rangle$ be its 
unique maximal ideal.
\begin{enumerate}[(1)]
    \item Note that if $I$ is a nonzero proper ideal of $R$, then 
    $I = M^n = \langle \pi^n \rangle$. Therefore, being a DVR is 
    equivalent to being a local PID that is not a field. 
    \item Let $0 \neq x \in R$. There are two possibilities: 
    either $x = u \in \R^\times$ or $x \notin R^\times$. In the latter case, 
    we have that $\langle x \rangle$ is a nonzero proper ideal of $R$, so 
    $\langle x \rangle = \langle \pi^n \rangle$ for some $n \in \N$. 
    Then we can write $x = u\pi^n$ for some $u \in R^\times$. Since 
    everything in the ring is a unit multiple of a power of $\pi$, it 
    now makes sense why we call $\pi$ a uniformizer. 
\end{enumerate}

The next proposition tells us that the localization of a Noetherian integral domain
is still Noetherian. 

\begin{prop}{prop:3.26}
    Let $R$ be a Noetherian integral domain and $P$ is a nonzero prime ideal, 
    then $R_P$ is Noetherian. 
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:3.26}]
    Let $I \subseteq R_P$ be an ideal. Our goal is to show that 
    $I$ is a finitely generated $R_P$-module. Note that 
    $J = I \cap R$ is an ideal of $R$. Since $R$ is Noetherian, we can 
    write $J = Rx_1 + \cdots + Rx_n$ where $x_i \in J$. 
    
    Let $x = \frac{a}{b} \in I$ where $a, b \in R$ and $b \notin P$. Then 
    $a = bx \in I \cap R = J$, so we can write 
    $a = r_1 x_1 + \cdots + r_n x_n$ for some $r_i \in R$. In particular, 
    we have 
    \[ x = \frac{a}{b} = \frac{r_1}{b} x_1 + \cdots + \frac{r_n}{b} x_n \] 
    where $\frac{r_i}{b} \in R_P$ and $x_i \in J \subseteq I$, so 
    $I = R_P x_1 + \cdots + R_P x_n$ is finitely generated as desired. \qed
\end{pf}\vspace{-0.25cm}

We are now ready to prove our goal that the localization of a Dedekind 
domain by a prime ideal is a DVR. 

\begin{theo}{theo:3.27}
    Let $R$ be a Dedekind domain and let $P$ be a nonzero prime ideal. 
    Then $R_P$ is a DVR. 
\end{theo}\vspace{-0.25cm}
\begin{pf}[Theorem~\ref{theo:3.27}]
    Since $P$ is nonzero, we know that $R_P$ is not a field. 
    Proposition~\ref{prop:3.26} tells us that $R_P$ is Noetherian, 
    and we have shown that $R_P$ is local (it's a localization 
    for goodness' sake). It suffices to prove that $P_P$, the unique 
    maximal ideal of $R_P$, is principal. 

    Since $R$ is a Dedekind domain, we know by Proposition~\ref{prop:3.13} 
    that there exists an ideal $I$ of $R$ such that $IP = \langle \alpha 
    \rangle$ for some $0 \neq \alpha \in P$. Consider the fractional 
    ideal $J = \frac{1}{\alpha} I$ and note that $JP = R$. Then 
    we can write $1 = a_1 b_1 + \cdots + a_n b_n$ where $a_i \in J$ and 
    $b_i \in P$. Choose $i$ such that $a_i b_i \notin P$. 
    (Such an $i$ must exist because if $a_i b_i \in P$ for all $i$, 
    then $1 \in P$.) We see that $\frac{1}{a_i b_i} \in R_P$.
    
    Now, let $x \in P_P$. We have $x = a_i b_i \cdot \frac{1}{a_i b_i} x$.
    Letting $y = \frac{1}{a_i b_i} x$, we have $y \in P_P$ since 
    $P_P$ is an ideal of $R_P$. Then we can write $y = \frac{u}{v}$ where 
    $u, v \in R$ with $u \in P$ and $v \notin P$. This yields 
    \[ x = b_i \frac{a_i u}{v}. \] 
    Since $a_i \in J$ and $u \in P$, we get $a_i u \in JP = R$, so 
    $x \in \langle \frac{b_i}{1} \rangle \subseteq R_P$. This holds for 
    all $x \in P_P$, so $P_P \subseteq \langle \frac{b_i}{1} \rangle$. 
    The reverse containment follows because $b_i \in P$ and $1 \notin P$, 
    so $P_P = \langle \frac{b_i}{1} \rangle$. \qed 
\end{pf}\vspace{-0.25cm}

\subsection{Multiplicativity of the Ideal Norm} \label{subsec:3.7}
Equipped with all the tools, let's start proving that the ideal 
norm is multiplicative.

\begin{prop}{prop:3.28}
    Let $R$ be an integral domain and $P$ be a nonzero prime ideal of $R$. 
    For all $n \in \N$, we have 
    \[ R/P^n \cong R_P/P_P^n. \] 
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:3.28}]
    We leave it as an exercise to check that the map
    $r + P^n \mapsto \frac{r}{1} + P_P^n$
    is a well-defined isomorphism between these quotient spaces. \qed
\end{pf}\vspace{-0.25cm}

Recall that in Section~\ref{subsec:3.4}, we showed that the Chinese 
remainder theorem reduces the problem to proving that 
$N(P^n) = N(P)^n$. The next result is the key to this fact. 

\begin{prop}{prop:3.29}
    Let $R$ be a DVR and let $P$ be its maximal ideal. If $R/P$ is finite, then 
    for all $n \in \N$, we have 
    \[ |R/P^n| = |R/P|^n. \] 
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:3.29}]
    We proceed by induction. The base case is obvious. Suppose that 
    $|R/P^n| = |R/P|^n$ for some $n \geq 1$. Consider the map 
    $\varphi : R/P^{n+1} \to R/P^n$ defined by 
    \[ \varphi(r + P^{n+1}) = r + P^n. \]
    Since $P^{n+1} \subseteq P^n$, we see that $\varphi$ is well-defined. 
    It is easily verified that $\varphi$ is a surjective homomorphism. 
    Moreover, the kernel of $\varphi$ consists of the elements 
    already living in $P^n$, namely $\ker\varphi = P^n/P^{n+1}$. 
    By the first isomorphism theorem, we get 
    \[ (R/P^{n+1})/(P^n/P^{n+1}) \cong R/P^n. \] 
    Therefore, we have $|R/P^{n+1}| = |P^n/P^{n+1}| \cdot |R/P|^n$ by the 
    inductive hypothesis. (Note that we could've used the third 
    isomorphism theorem to get this isomorphism as well, but modding 
    out by $P^{n+1}$ would seemingly come out of nowhere.) 
    To finish off the proof, it is enough to show that $|P^n/P^{n+1}| 
    = |R/P|$. We'll do this using linear algebra. Consider the 
    field $F = R/P$, and let $V = P^n/P^{n+1}$ be an $F$-vector space 
    where scalar multiplication is defined by 
    \[ (r + P)(a + P^{n+1}) = ra + P^{n+1}. \] 
    (Check that this is well-defined.) Write $P = \langle \pi \rangle$ 
    and let $x \in V$. Then $x = a + P^{n+1}$ for some $a \in P^n$. 
    But then $a \in \langle \pi^n \rangle$ and so $a = c\pi^n$ for some $c \in R$. 
    This gives us 
    \[ x = c\pi^n + P^{n+1} = (c + P)(\pi^n + P^{n+1}). \] 
    In particular, we see that $V$ is spanned by $\pi^n + P^{n+1}$, which 
    shows that $\dim_F(V) = 1$ and $V \cong F$. From this, we deduce that 
    $|R/P| = |F| = |V| = |P^n/P^{n+1}|$. \qed 
\end{pf}\vspace{-0.25cm}

We finally have the multiplicativity of the ideal norm, whose usefulness 
has been greatly motivated by our work on the assignments.

\begin{theo}{theo:3.30}
    Let $R = {\cal O}_K$. If $I$ and $J$ are nonzero ideals of $R$, then 
    \[ N(IJ) = N(I) N(J). \] 
\end{theo}\vspace{-0.25cm}
\begin{pf}[Theorem~\ref{theo:3.30}]
    Let $P$ be a nonzero prime ideal. It suffices to show that $N(P^n) = N(P)^n$.
    Observe that 
    \begin{align*}
        N(P^n) = |R/P^n| 
        = |R_P/P_P^n|  
        = |R_P/P_P|^n 
        = |R/P|^n  
        = N(P)^n
    \end{align*}
    where the second and fourth equalities follow from Proposition~\ref{prop:3.28},
    and the third equality follows from Proposition~\ref{prop:3.29}. \qed 
\end{pf}\vspace{-0.25cm}