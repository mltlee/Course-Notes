\section{Ideal Class Group}\label{sec:4}

\subsection{Preliminaries}\label{subsec:4.1}
Let $K$ be a number field and let $R = {\cal O}_K$. Recall from 
\ref{A2-3} that if $X$ is the set of nonzero ideals of $R$, then we can put 
an equivalence relation on $X$ by $I \sim J$ if and only if $\alpha I = \beta J$ 
for some nonzero $\alpha, \beta \in R$. Then 
\[ G_K := \{[I] : I \in X\} \] 
is a group under the operation $[I][J] = [IJ]$, called the {\bf ideal 
class group} of $K$. The identity element is the equivalence class 
of nonzero principal ideals. In fact, this construction works for 
all Dedekind domains because nonzero ideals are invertible due to 
Proposition~\ref{prop:3.13}.

\begin{defn}{defn:4.1}
    Let $K$ be a number field. The {\bf class number} of $K$ is defined to be 
    \[ \cl(K) = |G_K|. \] 
\end{defn}\vspace{-0.25cm}

The ideal class group $G_K$ is structural information that is attached to 
the number field $K$ or the ring of integers ${\cal O}_K$. The class 
number $\cl(K)$ is a measure (in terms of complexity) of how far away 
${\cal O}_K$ is from being a PID because we have that $\cl(K) = 1$ 
if and only if ${\cal O}_K$ is a PID. 

The next result tells us that $\cl(K)$ is also a measure of how far away
${\cal O}_K$ is from being a UFD, and so having unique prime factorization 
of elements!

\begin{prop}{prop:4.2}
    Let $R$ be a Dedekind domain. Then $R$ is a PID if and only if $R$ is a UFD.
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:4.2}]
    $(\Rightarrow)$ This holds for any ring $R$. 

    $(\Leftarrow)$ Suppose that $R$ is a UFD and let $I$ be a nonzero proper ideal 
    of $R$. By Proposition~\ref{prop:3.13}, we can find an ideal $J$ of $R$ 
    such that $IJ = \langle \alpha \rangle$, where $\alpha \in I$ is nonzero. 
    But we can write $\alpha = p_1^{n_1} \cdots p_k^{n_k}$ for some 
    prime elements $p_i \in R$ and $n_i \in \N$. Then 
    \[ IJ = \langle \alpha \rangle = \langle p_1^{n_1} \cdots p_k^{n_k} \rangle 
    = \langle p_1 \rangle^{n_1} \cdots \langle p_k \rangle^{n_k}, \] 
    where each $\langle p_i \rangle$ is a prime ideal of $R$. It follows that 
    \[ I = \langle p_{i_1} \rangle^{m_1} \cdots \langle p_{i_\ell} \rangle^{m_\ell} 
    = \langle p_{i_1}^{m_1} \cdots p_{i_\ell}^{m_\ell} \rangle \] 
    for some $i_1, \dots, i_\ell \in \{1, \dots, k\}$, so $I$ 
    is principal and $R$ is a PID. \qed 
\end{pf}\vspace{-0.25cm}

At this point, it is not obvious that $\cl(K) < \infty$. Therefore, 
our next goal is to show that $G_K$ is a finite group. 

\begin{prop}{prop:4.3}
    Let $K$ be a number field and let $R = {\cal O}_K$. Then there exists
    $\lambda > 0$ such that for all nonzero ideals $I$ of $R$, there 
    is an nonzero element $\alpha \in I$ satisfying 
    \[ N(\langle \alpha \rangle) \leq \lambda N(I). \] 
\end{prop}\vspace{-0.25cm}

Note that we always have $N(I) \leq N(\langle \alpha \rangle)$ since 
$\langle \alpha \rangle \subseteq I$ and hence $I \mid \langle \alpha \rangle$. 
This proposition gives us an inequality in the other direction up to 
some $\lambda > 0$. 

\begin{pf}[Proposition~\ref{prop:4.3}]
    Let $n = [K : \Q]$, let $\{v_1, \dots, v_n\}$ be an integral basis for 
    ${\cal O}_K$, and let $\sigma_1, \dots, \sigma_n$ be the embeddings 
    of $K$ in $\C$. Pick $m \in \N$ such that $m^n \leq N(I) < (m+1)^n$. 
    Consider the elements of the form 
    \[ m_1 v_1 + \cdots + m_n v_n, \] 
    where $0 \leq m_i \leq m$ and $m_i \in \Z$. There are $(m+1)^n$ 
    such elements. Since $(m+1)^n > N(I) = |R/I|$, there exist 
    two such elements that are congruent modulo $I$. Subtracting these 
    yields a nonzero $\alpha \in I$ of the form 
    $\alpha = m_1 v_1 + \cdots + m_n v_n$
    where $0 \leq |m_i| \leq m$. Then we obtain 
    \begin{align*}
        N(\langle \alpha \rangle) = |N_{K/\Q}(\alpha)| 
        &= \left| \prod_{i=1}^n \sigma_i(\alpha) \right| 
        = \prod_{i=1}^n |\sigma_i(\alpha)| \\ 
        &\leq \prod_{i=1}^n \sum_{j=1}^n |m_j \sigma_i(v_j)| 
        \leq \prod_{i=1}^n \sum_{j=1}^n m|\sigma_i(v_j)| \\ 
        &= m^n \prod_{i=1}^n \sum_{j=1}^n |\sigma_i(v_j)| 
        \leq N(I) \prod_{i=1}^n \sum_{j=1}^n |\sigma_i(v_j)|.
    \end{align*}
    Taking $\lambda = \prod_{i=1}^n \sum_{j=1}^n |\sigma_i(v_j)|$ 
    gives the result. \qed 
\end{pf}\vspace{-0.25cm}
The next result tells us that every ideal class has a representative 
whose norm is bounded.

\begin{prop}{prop:4.4}
    Let $K$ be a number field and let $R = {\cal O}_K$. Let $\lambda > 0$ 
    be as in Proposition~\ref{prop:4.3}. For all nonzero ideals $I$ of $R$, 
    there exists an ideal $J$ of $R$ such that $[I] = [J]$ and $N(J) \leq \lambda$. 
\end{prop}\vspace{-0.25cm}
\begin{pf}[Proposition~\ref{prop:4.4}]
    Let $I$ be a nonzero ideal of $R$. Consider the ideal class $[I]^{-1} = 
    [I']$ represented by some ideal $I'$ of $R$. By Proposition~\ref{prop:3.13},
    we can find an ideal $J$ of $R$ such that $I'J = \langle \alpha \rangle$, 
    where $\alpha \in I$ is the nonzero element chosen as in 
    Proposition~\ref{prop:4.3}. Taking norms gives us 
    \[ N(I') N(J) = N(\langle \alpha \rangle) \leq \lambda N(I'), \] 
    and thus $N(J) \leq \lambda$. Moreover, we have $[I'][J] 
    = [\langle \alpha \rangle] = [\langle 1 \rangle]$, so 
    $[J] = [I']^{-1} = [I]$. \qed 
\end{pf}\vspace{-0.25cm}

This gives us the finiteness of the ideal class group. 

\begin{cor}{cor:4.5}
    Let $K$ be a number field. Then $G_K$ is finite. 
\end{cor}\vspace{-0.25cm}
\begin{pf}[Corollary~\ref{cor:4.5}]
    Let $[I] \in G_K$ be an ideal class. By Proposition~\ref{prop:4.4}, 
    we may assume that $N(I) \leq \lambda$. Suppose that the 
    prime factorization of $I$ is $I = P_1^{n_1} \cdots P_k^{n_k}$,
    where $N(P_i) = p_i^{f_i}$ for all $i = 1, \dots, k$. Since $p_i \in P_i$, 
    we have $P_i \mid \langle p_i \rangle$. Note that we must have 
    $p_i \leq \lambda$. Moreover, there are only finitely many 
    prime ideals $Q$ of $R$ such that $p \in Q$, where $p \in \N$ is prime 
    with $p \leq \lambda$. \qed 
\end{pf}\newpage 

\subsection{Minkowski's Bound} \label{subsec:4.2}
We know that the ideal class group is finite, but what now? The bound 
$\lambda$ we found has a couple of problems: 
\begin{enumerate}[(1)]
    \item It is difficult to compute; we require an integral basis
    for ${\cal O}_K$, the embeddings of $K$ in $\C$, and there are a large 
    amount of sums and products.
    \item In addition, $\lambda$ can be significantly larger than needed. 
\end{enumerate}
It turns out that there is a much better bound, obtained from 
our work on the geometry of numbers in Assignment 5! In \ref{A5-5}, 
we proved the following result:

\begin{theo}[Minkowski]{theo:4.6}
    Let $K$ be a number field with $[K : \Q] = n$, and let $R = {\cal O}_K$.
    Let $s$ be the number of pairs of nonreal embeddings of $K$ in $\C$. 
    Then every ideal class of $R$ contains an ideal $I$ such that 
    \[ N(I) \leq \frac{n!}{n^n} \left( \frac{4}{\pi} \right)^{\!s} \lvert\disc(K)\rvert^{1/2}. \]
\end{theo}\vspace{-0.25cm}

The main thing to notice is that $n!/n^n$ approaches $0$ extremely quickly, 
so this bound tends to be small. This helps us narrow down the 
primes to look at. 

{\bf Example.} Let $K = \Q(\alpha)$, where $\alpha$ 
is a root of the $2$-Eisenstein polynomial $f(x) = x^3 - 2x - 2$. 
with discriminant $-76 = -2^2 \cdot 19$. By \ref{A6-4}, we have 
${\cal O}_K = \Z[\alpha]$. 

Since $\disc(f(x)) = -76 < 0$, we see that $f(x)$ must have a pair of 
nonreal roots, because if they were all real, then $\disc(f(x))$ would 
be positive. But $\deg(f(x)) = 3$, so this gives us $s = 1$. 
Then the Minkowski bound is 
\[ B_K = \frac{3!}{3^3} \left( \frac{4}{\pi} \right)^{\!1} \sqrt{76} \approx 2.467. \] 
By Theorem~\ref{theo:4.6}, we have $G_K = \{[I] : N(I) \leq 2\}$.
It follows that $G_K$ is generated by the prime ideals $P$ such that $N(P) = 2$
by the multiplicativity of the ideal norm.
But working modulo $2$, we have $f(x) = x^3 \in \Z_2[x]$. Then Kummer-Dedekind 
gives us $\langle 2 \rangle = \langle \alpha, 2 \rangle^3 = \langle \alpha \rangle^3$, 
where $2 = \alpha^3 - 2\alpha \in \langle \alpha \rangle$. Therefore, 
we have $G_K = \{[\langle 1 \rangle], [\langle \alpha \rangle]\} = 
\{[\langle 1 \rangle]\}$ and $\cl(K) = 1$, which shows that ${\cal O}_K$ 
is a PID. 

{\bf Example.} Let $K = \Q(\sqrt{-23})$. We wish to compute the ideal class 
group of $K$ (i.e. find a well-known group that is isomorphic to $G_K$). 
Note that $G_K$ is a finite abelian group, so it is the direct product 
of cyclic groups.

We have $-23 \equiv 1 \pmod 4$, so ${\cal O}_K = \Z[\alpha]$ where 
$\alpha = \frac12(1 + \sqrt{-23})$. Since $(2\alpha - 1)^2 = -23$, 
we obtain $4\alpha^2 -4\alpha + 24 = 0$, implying that the minimal 
polynomial of $\alpha$ is $f(x) = x^2 - x + 6$. 
We know that the roots of $f(x)$ are $\alpha$ and its conjugate, 
which are not real. Then we have $s = 1$, and moreover, we know that 
$\disc(K) = -23$. Therefore, the Minkowski bound is 
\[ B_K = \frac{2!}{2^2} \cdot \frac{4}{\pi} \cdot \sqrt{23} \approx 3.053. \] 
Then every ideal class of $K$ contains a representative with norm at most $3$,
and so $G_K$ is generated by the prime ideals containing $2$ or $3$. 
Modulo $2$, we have $f(x) = x(x-1) \in \Z_2[x]$, so Kummer-Dedekind 
implies that $\langle 2 \rangle = \langle \alpha, 2 \rangle \langle \alpha-1, 2 \rangle$.
Set $P_1 = \langle \alpha, 2 \rangle$ and $P_2 = \langle \alpha-1, 2 \rangle$,
which satisfy $N(P_1) = N(P_2) = 2$.
Similarly, working modulo $3$, we have that $f(x) = x(x-1) \in \Z_3[x]$, we 
so $\langle 3 \rangle = \langle \alpha, 3 \rangle \langle \alpha-1, 3 \rangle$.
We set $Q_1 = \langle \alpha, 3 \rangle$ and $Q_2 = \langle \alpha-1, 3 \rangle$
with $N(Q_1) = N(Q_2) = 3$. Therefore, we obtain
\[ G_K = \{[\langle 1 \rangle], [P_1], [P_2], [Q_1], [Q_2]\} \] 
since these are the only ideals of norm at most $3$. 

Since $\langle 2 \rangle = P_1P_2$, we see that $[P_1]^{-1} = [P_2]$. 
Similarly, we have $[Q_1]^{-1} = [Q_2]$ since $\langle 3 \rangle = Q_1Q_2$.
In particular, we can write $G_K = \langle [P_1], [Q_1] \rangle$. 
Notice that $\alpha^2 - \alpha + 6 = 0$, so $-6 = \alpha(\alpha - 1)$. 
Using the equivalence relation on the nonzero ideals of ${\cal O}_K$, we 
have that 
\[ (\alpha - 1)P_1 = \langle \alpha(\alpha-1), 2(\alpha-1) \rangle 
= \langle -6, 2(\alpha-1) \rangle = 2\langle 3, \alpha-1 \rangle = 2Q_2, \] 
so $[P_1] = [Q_2]$. By taking inverses, we obtain $[P_2] = [P_1]^{-1} = 
[Q_2]^{-1} = [Q_1]$, so we have reduced the ideal class group to $G_K = 
\langle [P_1] \rangle$. That is, $G_K$ is a cyclic group. 

It remains to find the order of $[P_1]$. First, suppose that $P_1$ 
were a principal ideal. Write $P_1 = \langle \beta \rangle$ where 
$\beta = \frac12(a + b\sqrt{-23})$ for some $a, b \in \Z$. Taking norms, we have 
\[ 2 = |N_{K/\Q}(\beta)| = \left| \frac{a + b\sqrt{-23}}{2} \right| \left| \frac{a - b\sqrt{-23}}{2} \right| 
= \frac{a^2 + 23b^2}{4}, \] 
which implies that $a^2 + 23b^2 = 8$. But this has no solutions, so $P_1$
cannot be principal. Next, suppose that $P_1^2 = \langle \beta \rangle$
where $\beta$ is as above. 
This time, taking norms gives 
\[ 4 = \frac{a^2 + 23b^2}{4}, \] 
so $a^2 + 23b^2 = 16$. This has solutions $a = \pm 4$ and $b = 0$. 
But this would imply that $P_1^2 = \langle 2 \rangle = P_1P_2$. 
By the uniqueness of ideal prime factorization, we obtain
$P_1 = P_2$. But then $\alpha$ 
and $\alpha-1$ are both in $P_1$ and hence $1 \in P_1$, which is a 
contradiction. Hence, $P_1^2$ is not principal.

Now, observe that 
\begin{align*}
    G_K &= \{[\langle 1 \rangle], [P_1], [P_2], [Q_1], [Q_2]\}  
    = \{[\langle 1 \rangle], [P_1], [P_1]^{-1}\}
\end{align*}
since we have seen that $[P_1] = [P_2]^{-1} = [Q_2]$ and $[P_2] = [Q_1]$. 
In showing that $P_1$ is not principal, we have $[P_1] 
\neq [\langle 1 \rangle]$. This also gives us $[P_1]^{-1} \neq 
[\langle 1 \rangle]$. Indeed, if we had $[P_1]^{-1} = [\langle 1 \rangle]$,
then $[\langle 1 \rangle] = [P_1][P_2] = [P_1][\langle 1 \rangle]$,
which would imply that $[P_1] = [\langle 1 \rangle]$. Moreover, 
since $P_1^2$ is not principal, we have $[P_1] \neq [P_1]^{-1}$. 
Therefore, the elements $[\langle 1 \rangle]$, $[P_1]$, and $[P_1]^{-1}$ 
are all distinct, which gives 
\[ G_K = \{[\langle 1 \rangle], [P_1], [P_1]^{-1}\} \cong \Z_3. \] 
{\bf Exercise.} Let $K = \Q(\sqrt{-15})$. Show that $G_K \cong \Z_2$. 

{\bf Example.} Let $K = \Q(\alpha)$, where $\alpha \in \C$ is a root of 
$f(x) = x^3 + 4x + 1$. Note that $f(x)$ has discriminant $-283$, which 
is prime. Let $R = {\cal O}_K$. Is $R$ a PID? 

Since $\disc(f(x)) = -283$ is squarefree, we have $R = \Z[\alpha]$ 
and $\disc(K) = \disc(f(x)) = -283$. 
Moreover, it is negative, so $s = 1$. This gives the Minkowski bound 
\[ B_K = \frac{3!}{3^3} \cdot \frac{4}{\pi} \cdot \sqrt{283} \approx 4.76. \] 
Then every ideal class contains a representative with norm at most $4$, 
and $G_K$ is generated by the prime ideals containing $2$ or $3$. 
\begin{itemize}
    \item Modulo $2$, we have $f(x) = x^3 + 1 = (x+1)(x^2+x+1) \in \Z_2[x]$, so $\langle 2 \rangle 
    = \langle \alpha+1, 2 \rangle \langle \alpha^2 + \alpha + 1, 2 \rangle$. 
    Set $P_1 = \langle \alpha+1, 2 \rangle$ and $P_2 = \langle \alpha^2 + 
    \alpha + 1, 2 \rangle$. We have $N(P_1) = 2$ and $N(P_2) = 2^2 = 4$. 
    \item Modulo $3$, we have $f(x) = x^3 + x + 1 = (x-1)(x^2 + x + 2) \in \Z_3[x]$, 
    so $\langle 3 \rangle = \langle \alpha-1, 3 \rangle \langle \alpha^2 + \alpha^2 
    +2, 3 \rangle$. Set $Q_1 = \langle \alpha-1, 3 \rangle$ and 
    $Q_2 = \langle \alpha^2 + \alpha^2 +2, 3 \rangle$. Note that 
    $N(Q_1) = 3$ and $N(Q_2) = 3^2 = 9 > 4$. 
\end{itemize}
Putting these together, the ideals with norm at most $4$ are 
\[ G_K = \{[\langle 1 \rangle], [P_1], [Q_1], [P_2], [P_1^2]\}. \] 
Note that $[P_1^2] = [P_1]^2$ and $[P_1] = [P_2]^{-1}$. Our next idea is to 
look at $[Q_1]$ first since all the other elements are generated by $[P_1]$.
By polynomial long division, we find that 
\[ x^3 + 4x + 1 = (x - 1)(x^2 + x + 5) + 6. \] 
This looks very promising to us since $6 = 2 \cdot 3$, and 
we can write $-6 = (\alpha-1)(\alpha^2 + \alpha + 5)$. Observe that 
\begin{align*}
    (\alpha^2 + \alpha + 5)Q_1 &= \langle (\alpha-1)(\alpha^2 + \alpha + 5), 
    3(\alpha^2 + \alpha + 5) \rangle \\ 
    &= \langle 6, 3(\alpha^2 + \alpha + 5) \rangle \\ 
    &= 3 \langle 2, \alpha^2 + \alpha + 5 \rangle \\ 
    &= 3 \langle 2, \alpha^2 + \alpha + 1 \rangle \\ 
    &= 3P_2,
\end{align*}
so $[Q_1] = [P_2] = [P_1]^{-1}$ and $G_K = \langle [P_1] \rangle$. 
To conclude if $R = {\cal O}_K$ is a PID or not, we must check whether 
or not $P_1$ is a principal ideal. But this is a very difficult problem in general! 
It turns out that in this case, $P_1$ is not principal, so ${\cal O}_K$ is 
not a PID. We'll revisit this example later. 

We devise a strategy to check that an ideal $P_1$ of ${\cal O}_K$ is 
not principal.
Suppose that we could write $P_1 = \langle \beta \rangle$. Then 
we also have $P_1 = \langle u\beta \rangle$ for all $u \in {\cal O}_K^\times$.
\begin{enumerate}[(1)]
    \item Compute the group of units ${\cal O}_K^\times$. 
    \item Argue that $P_1 = \langle u\beta \rangle$ for ``small'' $u\beta$.
    We'll explain what we mean by ``small'' later.
    \item This will give us a short list of $u\beta$ to check that 
    $P_1 \neq \langle u\beta \rangle$, so $P_1$ is not principal.
\end{enumerate}
Alternatively, if it were the case that $P_1 = \langle u\beta \rangle$ for 
some $u\beta$ in that short list, then $P_1$ is principal.