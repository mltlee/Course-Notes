\section{Lebesgue Measure and Integration}\label{sec:2}

\subsection{Riemann Integration}\label{subsec:2.1}
Recall that in Riemann's theory of integration, we start with a bounded function 
$f : [a, b] \to \R$. We could then obtain $\int_a^b f(x)\dd x$ via 
approximations of Riemann sums. More specifically, we take a partition 
\[ P = \{a = t_0 < t_1 < \cdots < t_n = b\} \] 
of the interval $[a, b]$. For each $1 \leq i \leq n$, we set 
$m_i = \inf_{x \in [t_{i-1}, t_i)} f(x)$ and 
$M_i = \sup_{x \in [t_{i-1}, t_i)} f(x)$. We define the {\bf lower 
Riemann sum} by 
\[ L(f, P) = \sum_{i=1}^n m_i(t_i - t_{i-1}), \] 
and similarly, the {\bf upper Riemann sum} by 
\[ U(f, P) = \sum_{i=1}^n M_i(t_i - t_{i-1}). \] 
It is clear for all partitions $P$ of $[a, b]$ that $L(f, P) \leq U(f, P)$. 
Moreover, suppose $P$ and $Q$ are both partitions of $[a, b]$, and set 
$P \vee Q$ to be the partition consisting of all points in $P$ and $Q$. 
Then recall that $P \vee Q$ refines both $P$ and $Q$, and we have 
\[ L(f, P) \leq L(f, P \vee Q) \leq U(f, P \vee Q) \leq U(f, Q). \] 
Interchanging $P$ and $Q$ above gives us $L(f, Q) \leq U(f, P)$, so we can 
deduce that 
\[ \sup_P L(f, P) \leq \inf_P U(f, P). \] 
That is, any lower Riemann sum of a given partition will always be at most 
the upper Riemann sum of any other partition. 

\begin{defn}{defn:2.1}
    We say that $f : [a, b] \to \R$ is {\bf Riemann integrable} if 
    \[ \sup_P L(f, P) = \inf_P U(f, P). \] 
    In this case, we write 
    \[ \int_a^b f(x)\dd x = \sup_P L(f, P) = \inf_P U(f, P). \] 
    We write $R[a, b]$ to denote the vector space of Riemann integrable 
    functions $f : [a, b] \to \R$. 
\end{defn}

Riemann's theory is good for many purposes, such as for the Fundamental 
Theorem of Calculus or analysis over smooth manifolds. But there are also 
many deficiencies. 

For one, it forces $f$ to be bounded and ``almost continuous''. It also doesn't 
generalize to integration over sets that are not ``like'' $\R$ or $\R^N$. 
Sometimes, one wants to integrate functions over irregular sets, such as fractals. 

Worst of all, there are no good limit theorems! Ideally, we want some kind of 
``monotone convergence theorem'' which says that if we have a sequence of 
Riemann integrable functions $(f_n)_{n=1}^\infty \subseteq R[a, b]$ satisfying 
$f_1 \leq f_2 \leq \cdots$ and $f(x) = 
\lim_{n\to\infty} f_n(x)$ exists, then $f$ is also Riemann integrable with 
\[ \int_a^b f(x)\dd x = \lim_{n\to\infty} \int_a^b f_n(x)\dd x. \] 
Unfortunately, this result is false! Note that the pointwise limit of Riemann 
integrable functions might not even be Riemann integrable. Let 
$\{r_n\}_{n=1}^\infty$ be an enumeration of $\Q \cap [0, 1]$, and for each 
$n \in \N$, define the function $f_n : [0, 1] \to \R$ by 
\[ f_n(x) = \begin{cases}
    1, & \text{if } x \in \{r_1, \dots, r_n\}, \\ 
    0, & \text{otherwise.} 
\end{cases} \] 
Then for all $n \in \N$, we have $f_n \in R[0, 1]$ with 
\[ \int_0^1 f_n(x)\dd x = 0. \] 
Moreover, we see that $(f_n)_{n=1}^\infty$ converges pointwise to 
\[ f(x) = \begin{cases} 
    1, & \text{if } x \in \Q \cap [0, 1], \\ 
    0, & \text{otherwise,} 
\end{cases} \] 
the indicator function of $\Q$ over $[0, 1]$. Notice that this is a nice 
monotone limit since $f_1 \leq f_2 \leq \cdots$. Even still, $f \notin R[0, 1]$
since the rationals and irrationals are dense in $\R$, so given any 
partition $P$ of $[0, 1]$, the upper Riemann sum is $U(f, P) = 1$ and 
the lower Riemann sum is $L(f, P) = 0$. 

\subsection{Lebesgue Outer Measure}\label{subsec:2.2}
In our previous section, we saw that Riemann's theory of integration had 
some flaws. Lebesgue had the idea that we could do Riemann sums over 
partitions of the $y$-axis, instead of partitions over the $x$-axis. It turns 
out that this idea extends allows many more functions to be integrable. 

Take a function $f : [a, b] \to \R$, and suppose that we have a partition 
$P = \{y_0 < y_1 < \cdots < y_n\}$ of the $y$-axis. Then we will take sums of 
terms of the form 
\[ y_i \cdot \ell(\{x \in [a, b] : f(x) \in (y_{i-1}, y_i]\}), \] 
where $\ell(E)$ denotes the ``length'' of $E$. Notice that the set above 
is the preimage of the half-open interval $(y_{i-1}, y_i]$, and so we have an 
approximation 
\[ \int_a^b f(x)\dd x \approx \sum_{i=1}^n y_i \cdot \ell(f^{-1}(y_{i-1}, y_i]). \] 
Now, consider the case where $f$ is the indicator function of $\Q$ over 
$[0, 1]$ as we discussed above. Then we would have 
\[ \int_0^1 f(x)\dd x \approx 1 \cdot \ell(\Q \cap [0, 1]) + 0 \cdot 
\ell(\Q^c \cap [0, 1]). \] 
We would expect this to equal $0$ if we want our ``monotone convergence theorem''
to hold, and also because $\Q$ is a countable set. As such, a desired property 
of our ``length'' function would be to have $\ell(\Q \cap [0, 1]) = 0$. 

We have now packaged the problem into generalizing the notion of length 
from nice sets (such as unions of intervals) to more complicated sets 
of the form $f^{-1}(y_{i-1}, y_i]$. This turns out to be a difficult task 
even for a continuous function $f$. We wish to have a function 
\[ m : {\cal P}(\R) \to [0, \infty] \] 
satisfying the following properties: 
\begin{enumerate}[(1)]
    \item For any interval $I$ from $a$ to $b$ (which could be open, closed, 
    or half-open), we have 
    \[ m(I) = b-a. \] 
    \item {\bf Translation invariance.} For all $x \in \R$, we have 
    \[ m(E + x) = m(E), \] 
    where $E + x = \{y + x : y \in E\}$. 
    \item {\bf Countable additivity.} If $E_n \subseteq \R$ are disjoint 
    for all $n \in \N$ and $E = \bigsqcup_{n=1}^\infty E_n$, then 
    \[ m(E) = \sum_{n=1}^\infty m(E_n). \] 
\end{enumerate}
Bad news: there is no function $m : {\cal P}(\R) \to [0, \infty]$ 
satisfying all of (1) to (3)! 

To see this, we will assume there is such a function $m$ satisfying all $3$ 
properties, and find a subset $E \subseteq [0, 1)$ such that $m(E)$ is not 
well-defined. Define an equivalence relation on $[0, 1)$ by $x \sim y$ 
if and only if $x - y \in \Q$. We leave it as an exercise to verify that 
this is indeed an equivalence relation. As usual, let $[x]$ be the 
equivalence class of each $x \in [0, 1)$. 

Choose a set $E$ of representatives of all the equivalence classes $[x]$ for 
$x \in [0, 1)$. Note that this is possible by the Axiom of Choice, and we have 
$E \subseteq [0, 1)$ with $|E \cap [x]| = 1$ for all $x \in [0, 1)$. 

We claim that $m(E)$ is not well-defined. Let $\{r_n\}_{n=1}^\infty$ be 
an enumeration of $\Q \cap [0, 1)$, and for each $n \in \N$, set 
\begin{align*}
    E_n = E + r_n \text{ (mod $1$)} = ((E + r_n) \cap [0, 1)) \sqcup 
    ((E + r_n - 1) \cap [0, 1)). 
\end{align*}
Since $m$ satisfies properties (1) to (3), we have that 
\begin{align*}
    m(E_n) &= m((E + r_n) \cap [0, 1)) + m((E + r_n - 1) \cap [0, 1)) & 
    \text{by (3)} \\ 
    &= m((E + r_n) \cap [0, 1)) + m((E + r_n) \cap [1, 2)) & \text{by (2)} \\ 
    &= m(E + r_n) & \text{by (3)} \\ 
    &= m(E) & \text{by (2)}
\end{align*}
for all $n \in \N$. We leave it as an exercise to check that $[0, 1) = 
\bigsqcup_{n=1}^\infty E_n$. It follows that 
\[ 1 = m([0, 1)) = \sum_{m=1}^\infty m(E_n) = \sum_{n=1}^\infty m(E) \] 
where the second equality comes from (3), so there is no admissible value for 
$m(E)$. 

In light of this result, we might be asking too much for $m$ 
to satisfy all $3$ properties. What can we do instead? 
\begin{enumerate}[(a)]
    \item We can restrict the domain of the function $m$ to a 
    more ``tractable'' family of subsets of $\R$. Naturally, we would want to 
    allow all intervals, as well as open and closed sets, to be in this family.
    \item One other approach is to take a function $m$ that works for all 
    subsets $E \subseteq \R$ and agrees with our intuitive notion of length 
    for intervals, but in doing so, sacrificing some of the desirable properties. 
\end{enumerate}

The standard approach is the first one, and we shall adopt it. We now 
introduce a candidate function that could be used for $m$. 

\begin{defn}{defn:2.2}
    The {\bf Lebesgue outer measure} of a subset $E \subseteq \R$ is defined to be 
    \[ m^*(E) = \inf\left\{ \sum_{n=1}^\infty \ell(I_n) : \{I_n\}_{n=1}^\infty 
    \text{ a cover of $E$ by intervals}\right\}. \] 
\end{defn}

We look at some properties of the Lebesgue outer measure. 

\begin{prop}{prop:2.3}
    \begin{enumerate}[(a)]
        \item We have $m^*(\varnothing) = 0$ and $m^*(E) \geq 0$ 
        for all $E \subseteq \R$. 
        \item {\bf Translation invariance.} For all $E \subseteq \R$ and 
        $x \in \R$, we have $m^*(E+x) = m^*(E)$. 
        \item {\bf Monotonicity.} If $E \subseteq F \subseteq \R$, then 
        $m^*(E) \leq m^*(F)$. 
        \item {\bf Countable subadditivity.} Suppose that $E = 
        \bigcup_{n=1}^\infty E_n$ where the subsets $E_n \subseteq \R$ are not 
        necessarily disjoint. Then 
        \[ m^*(E) \leq \sum_{n=1}^\infty m^*(E_n). \] 
    \end{enumerate}
\end{prop}
\begin{pf}~
    \begin{enumerate}[(a)]
        \item This is clear from definition. 
        \item Coverings of $E$ by countable families of intervals are in 
        bijection with those of $E + x$. In particular, we have 
        $E \subseteq \bigcup_{n=1}^\infty I_n$ if and only if 
        $E + x \subseteq \bigcup_{n=1}^\infty (I_n + x)$, with 
        \[ \sum_{n=1}^\infty \ell(I_n) = \sum_{n=1}^\infty \ell(I_n + x). \] 
        Taking infima, we obtain $m^*(E) = m^*(E + x)$. 
        \item Any covering $\bigcup_{n=1}^\infty I_n$ of $F$ also gives a 
        covering of $E$. On the other hand, coverings of $E$ are not 
        necessarily coverings of $F$. Then the infimum in $m^*(E)$ is 
        taken over a larger collection than with $m^*(F)$, so we get 
        $m^*(E) \leq m^*(F)$. 
        \item Without loss of generality, suppose that $\sum_{n=1}^\infty 
        m^*(E_n) < \infty$. Let $\eps > 0$. Since $m^*(E_n) < \infty$ 
        for all $n \in \N$, there exists a covering $\bigcup_{k=1}^\infty 
        I_{k,n}$ of $E_n$ such that 
        \[ \sum_{k=1}^\infty \ell(I_{k,n}) < m^*(E_n) + \frac{\eps}{2^n}. \] 
        Then we have $E = \bigcup_{n=1}^\infty E_n \subseteq 
        \bigcup_{n,k=1}^\infty I_{k,n}$, so it follows that 
        \begin{align*}
            m^*(E) &\leq \sum_{n=1}^\infty \sum_{k=1}^\infty \ell(I_{k,n}) \\ 
            &\leq \sum_{n=1}^\infty \left( m^*(E_n) + \frac{\eps}{2^n} \right) \\
            &= \sum_{n=1}^\infty m^*(E_n) + \eps. 
        \end{align*}
        Since $\eps > 0$ was arbitrary, the result follows. \qedhere 
    \end{enumerate}
\end{pf}

The following result tells us that we can compute $m^*(E)$ using ``small''
open intervals $I_n$ in our covers. 

\begin{prop}{prop:2.4}
    Let $E \subseteq \R$ and $\delta > 0$. Then 
    \[ m^*(E) = \inf\left\{ \sum_{n=1}^\infty \ell(I_n) : 
    \{I_n\}_{n=1}^\infty \text{ a cover of $E$ by open intervals such that }
    \ell(I_n) < \delta \right\}. \] 
\end{prop}
\begin{pf}
    It is clear that $m^*(E)$ is at most the right hand side, because 
    the collection we are taking the infimum over in the definition of 
    $m^*$ is more general than the one in this proposition, which forces 
    the intervals to be open and have length less than $\delta$. 

    So, we turn to proving the other direction. Without loss of generality, 
    we may assume that $m^*(E) < \infty$. Let $\eps > 0$. We can 
    find intervals $\{J_n\}_{n=1}^\infty$ such that $E \subseteq 
    \bigcup_{n=1}^\infty J_n$ and 
    \[ \sum_{n=1}^\infty \ell(J_n) \leq m^*(E) + \eps. \] 
    Without loss of generality, we can also partition these intervals 
    $\{J_n\}_{n=1}^\infty$ into subintervals so that $\ell(J_n) < \delta$
    for all $n \in \N$. Now, choose open intervals $I_n \supseteq J_n$ 
    such that $\ell(I_n) \leq \max\{\delta, \ell(J_n) + \eps/2^n\}$. 
    We see that $E \subseteq \bigcup_{n=1}^\infty I_n$ with 
    \[ \sum_{n=1}^\infty \ell(I_n) \leq \sum_{n=1}^\infty 
    \left( \ell(J_n) + \frac{\eps}{2^n} \right) \leq (m^*(E) + \eps) + \eps 
    = m^*(E) + 2\eps. \] 
    Taking infima, we see that $m^*(E)$ is at least the right hand side 
    and we are done. 
\end{pf}

Next, we show that Lebesgue outer measure really generalizes length. 

\begin{theo}{theo:2.5}
    Let $I$ be an interval with left endpoint $a$ and right endpoint $b$, where 
    $a < b \in \R$. Then 
    \[ m^*(I) = \ell(I) = b-a. \]  
\end{theo}
\begin{pf}
    We first prove this for the case where $I = [a, b]$ is a compact interval. 
    By taking $I_1 = I$ and $I_2 = \varnothing$ for $n \geq 2$, the 
    collection $\{I_n\}_{n=1}^\infty$ is a cover of $[a, b]$ by intervals, 
    which implies that 
    \[ m^*(I) \leq \sum_{n=1}^\infty \ell(I_n) = \ell(I_1) = b-a. \] 
    Thus, we have $m^*(I) \leq b-a$. We now turn to showing that 
    $m^*(I) \geq b-a$. Let $\eps > 0$. By Proposition~\ref{prop:2.4}, we can 
    find an open cover $\bigcup_{n=1}^\infty (a_n, b_n)$ of $I$ such that 
    \[ \sum_{n=1}^\infty (b_n - a_n) \leq m^*(I) + \eps. \] 
    But $I$ is compact, so we can find a finite subcover; that is, 
    there exists $N \in \N$ such that $I \subseteq \bigcup_{n=1}^N (a_n, b_n)$. 
    Without loss of generality, we may toss away any intervals $I_n$ such that 
    $I_n \cap I = \varnothing$, and reorder the $I_n$'s if necessary to get 
    $a_1 < a_2 < \cdots < a_N$. Since $I$ is an interval, it is connected. 
    Thus, the intervals $(a_n, b_n)$ must overlap, and we obtain 
    \[ \ell(I) = b-a \leq \sum_{n=1}^N (b_n - a_n) \leq 
    \sum_{n=1}^\infty (b_n - a_n) \leq m^*(I) + \eps. \] 
    But $\eps > 0$ was arbitrary, so we have $m^*(I) \geq \ell(I) = b-a$, as 
    desired. 

    We now prove the result in the case that $I = (a, b]$. For all 
    $0 < \eps < b-a$, we have $[a + \eps, b] \subseteq (a, b] \subseteq 
    [a, b]$. By the monotonicity of Lebesgue outer measure 
    (Proposition~\ref{prop:2.3}), we see that 
    \[ (b-a) - \eps = m^*[a + \eps, b] \leq m^*(a, b] \leq m^*[a, b] = b-a. \] 
    Since $\eps$ is arbitrary (subject to $0 < \eps < b-a$), we deduce that 
    $m^*(a, b] = b-a$. The cases where $I = [a, b)$ and $I = (a, b)$ are 
    proved similarly. 
\end{pf}
